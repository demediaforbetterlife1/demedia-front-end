"use client";

import React, { createContext, useContext, useEffect, useMemo, useState } from "react";

type Translations = Record<string, string>;

type Locale = string;

interface I18nContextType {
  language: Locale;
  setLanguage: (lng: Locale) => void;
  t: (key: string, fallback?: string) => string;
  supportedLocales: { code: string; name: string }[];
}

const I18nContext = createContext<I18nContextType | undefined>(undefined);

export const useI18n = (): I18nContextType => {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error("useI18n must be used within I18nProvider");
  return ctx;
};

// 100+ ISO codes mapped to human names. Many will alias to English until translations are provided.
const SUPPORTED: { code: string; name: string }[] = [
  { code: "en", name: "English" },
  { code: "ar", name: "Arabic" },
  { code: "es", name: "Spanish" },
  { code: "fr", name: "French" },
  { code: "de", name: "German" },
  { code: "tr", name: "Turkish" },
  { code: "it", name: "Italian" },
  { code: "ru", name: "Russian" },
  { code: "zh", name: "Chinese (Simplified)" },
  { code: "zh-TW", name: "Chinese (Traditional)" },
  { code: "ja", name: "Japanese" },
  { code: "ko", name: "Korean" },
  { code: "pt", name: "Portuguese" },
  { code: "pt-BR", name: "Portuguese (Brazil)" },
  { code: "hi", name: "Hindi" },
  { code: "bn", name: "Bengali" },
  { code: "pa", name: "Punjabi" },
  { code: "ur", name: "Urdu" },
  { code: "fa", name: "Persian" },
  { code: "id", name: "Indonesian" },
  { code: "ms", name: "Malay" },
  { code: "vi", name: "Vietnamese" },
  { code: "th", name: "Thai" },
  { code: "ta", name: "Tamil" },
  { code: "te", name: "Telugu" },
  { code: "mr", name: "Marathi" },
  { code: "gu", name: "Gujarati" },
  { code: "kn", name: "Kannada" },
  { code: "ml", name: "Malayalam" },
  { code: "or", name: "Odia" },
  { code: "as", name: "Assamese" },
  { code: "ne", name: "Nepali" },
  { code: "si", name: "Sinhala" },
  { code: "my", name: "Burmese" },
  { code: "km", name: "Khmer" },
  { code: "lo", name: "Lao" },
  { code: "am", name: "Amharic" },
  { code: "sw", name: "Swahili" },
  { code: "ha", name: "Hausa" },
  { code: "yo", name: "Yoruba" },
  { code: "ig", name: "Igbo" },
  { code: "zu", name: "Zulu" },
  { code: "xh", name: "Xhosa" },
  { code: "af", name: "Afrikaans" },
  { code: "nl", name: "Dutch" },
  { code: "sv", name: "Swedish" },
  { code: "no", name: "Norwegian" },
  { code: "da", name: "Danish" },
  { code: "fi", name: "Finnish" },
  { code: "pl", name: "Polish" },
  { code: "cs", name: "Czech" },
  { code: "sk", name: "Slovak" },
  { code: "hu", name: "Hungarian" },
  { code: "ro", name: "Romanian" },
  { code: "bg", name: "Bulgarian" },
  { code: "uk", name: "Ukrainian" },
  { code: "el", name: "Greek" },
  { code: "he", name: "Hebrew" },
  { code: "sr", name: "Serbian" },
  { code: "hr", name: "Croatian" },
  { code: "sl", name: "Slovenian" },
  { code: "bs", name: "Bosnian" },
  { code: "mk", name: "Macedonian" },
  { code: "et", name: "Estonian" },
  { code: "lv", name: "Latvian" },
  { code: "lt", name: "Lithuanian" },
  { code: "is", name: "Icelandic" },
  { code: "ga", name: "Irish" },
  { code: "mt", name: "Maltese" },
  { code: "cy", name: "Welsh" },
  { code: "sq", name: "Albanian" },
  { code: "az", name: "Azerbaijani" },
  { code: "kk", name: "Kazakh" },
  { code: "ky", name: "Kyrgyz" },
  { code: "uz", name: "Uzbek" },
  { code: "tk", name: "Turkmen" },
  { code: "mn", name: "Mongolian" },
  { code: "ps", name: "Pashto" },
  { code: "ku", name: "Kurdish" },
  { code: "bo", name: "Tibetan" },
  { code: "dv", name: "Divehi" },
  { code: "hy", name: "Armenian" },
  { code: "ka", name: "Georgian" },
  { code: "be", name: "Belarusian" },
  { code: "tt", name: "Tatar" },
  { code: "ba", name: "Bashkir" },
  { code: "kkj", name: "Kako" },
  { code: "qu", name: "Quechua" },
  { code: "ay", name: "Aymara" },
  { code: "gn", name: "Guarani" },
  { code: "ht", name: "Haitian Creole" },
  { code: "lb", name: "Luxembourgish" },
  { code: "rm", name: "Romansh" },
  { code: "eo", name: "Esperanto" },
  { code: "la", name: "Latin" },
  { code: "tl", name: "Tagalog" },
  { code: "fil", name: "Filipino" },
  { code: "sr-Latn", name: "Serbian (Latin)" },
  { code: "kk-Cyrl", name: "Kazakh (Cyrillic)" },
  { code: "kk-Latn", name: "Kazakh (Latin)" },
  { code: "bs-Latn", name: "Bosnian (Latin)" },
  { code: "bs-Cyrl", name: "Bosnian (Cyrillic)" },
];

const BASE_TRANSLATIONS: Record<Locale, Translations> = {
  en: {
    "auth.welcomeBack": "Welcome Back",
    "auth.login": "Login",
    "auth.signUp": "Sign Up",
    "auth.email": "Email Address",
    "auth.phone": "Phone Number",
    "auth.password": "Password",
    "auth.noAccount": "Don't have an account?",
    "auth.haveAccount": "Already have an account?",
    "auth.signingIn": "Signing In...",
    "auth.creatingAccount": "Creating Account...",
    "setup.completeProfile": "Complete Your Profile",
    "setup.preferredLanguage": "Preferred Language",
    "setup.phoneNumber": "Phone Number",
    "setup.saveContinue": "Save & Continue",
    "setup.saving": "Saving...",
    "common.save": "Save",
    "common.continue": "Continue",
    "common.loading": "Loading",
    "navbar.notifications": "Notifications",
    "navbar.messages": "Messages",
    "navbar.profile": "Profile",
    "navbar.logout": "Logout",
    "settings.title": "Settings",
    "settings.language": "Language",
    "settings.account": "Account",
    "settings.security": "Security",
    "settings.notifications": "Notifications",
    "settings.privacy": "Privacy",
    "settings.appearance": "Appearance",
    "settings.support": "Support",
    "index.checkingAuth": "Checking authentication...",
    "posts.loading": "Loading posts...",
    "posts.none": "No posts yet.",
    "posts.error": "Error",
    "posts.unknown": "Unknown",
    "posts.image": "Image",
    "posts.like": "Like",
    "posts.comment": "Comment",
    "posts.share": "Share",
    "stories.add": "Add Story",
    "stories.loading": "Loading stories...",
    "stories.none": "No stories yet.",
    "stories.error": "Error loading stories",
    "home.welcome": "Welcome to DeMedia",
    "home.feed": "Your Feed",
    "home.trending": "Trending",
    "home.suggestions": "Suggestions",
    "auth.name": "Full Name",
    "auth.username": "Username",
    "auth.confirmPassword": "Confirm Password",
    "auth.rememberMe": "Remember me",
    "auth.forgotPassword": "Forgot password?",
    "auth.verificationSent": "Verification email sent to your Gmail! Please check your inbox and click the verification link to complete login.",
    "auth.checkGmail": "📧 Check your Gmail inbox for the verification link",
    "auth.resendVerification": "Resend verification email",
    "auth.usernameRequired": "Username is required",
    "auth.usernameMinLength": "Username must be at least 3 characters",
    "auth.nameRequired": "Full name is required",
    "auth.emailRequired": "Email address is required",
    "auth.passwordRequired": "Password is required",
    "auth.passwordMinLength": "Password must be at least 8 characters",
    "auth.passwordMatch": "Passwords must match",
    "auth.usernameTaken": "This username is already taken",
    "auth.emailRegistered": "This email address is already registered",
    "auth.registrationFailed": "Registration failed. Please try a different username or email address.",
    "auth.registrationFailedGeneric": "Registration failed. Please try again.",
    "auth.loginFailed": "Login failed",
    "auth.invalidCredentials": "Invalid credentials",
    "auth.userCreated": "User created successfully. You can now login.",
    "auth.creatingAccount": "Creating Account...",
    "auth.signingIn": "Signing In...",
    "auth.login": "Login",
    "auth.signUp": "Sign Up",
    "auth.signUpTitle": "Create Account",
    "auth.welcomeBack": "Welcome Back",
    "auth.welcomeTitle": "Join DeMedia",
    "auth.alreadyHaveAccount": "Already have an account?",
    "auth.dontHaveAccount": "Don't have an account?",
    "auth.goToLogin": "Go to Login",
    "auth.tryAgain": "Try Again",
    "auth.emailInvalid": "Please enter a valid email address",
    "auth.usernameInvalid": "Username can only contain lowercase letters, numbers, and underscores",
  },
  ar: {
    "auth.welcomeBack": "مرحباً بعودتك",
    "auth.login": "تسجيل الدخول",
    "auth.signUp": "إنشاء حساب",
    "auth.email": "البريد الإلكتروني",
    "auth.phone": "رقم الهاتف",
    "auth.password": "كلمة المرور",
    "auth.noAccount": "ليس لديك حساب؟",
    "auth.haveAccount": "لديك حساب بالفعل؟",
    "auth.signingIn": "جاري تسجيل الدخول...",
    "auth.creatingAccount": "جاري إنشاء الحساب...",
    "setup.completeProfile": "أكمل ملفك الشخصي",
    "setup.preferredLanguage": "اللغة المفضلة",
    "setup.phoneNumber": "رقم الهاتف",
    "setup.saveContinue": "حفظ ومتابعة",
    "setup.saving": "جاري الحفظ...",
    "common.save": "حفظ",
    "common.continue": "متابعة",
    "common.loading": "جاري التحميل",
    "navbar.notifications": "الإشعارات",
    "navbar.messages": "الرسائل",
    "navbar.profile": "الملف الشخصي",
    "navbar.logout": "تسجيل الخروج",
    "settings.title": "الإعدادات",
    "settings.language": "اللغة",
    "settings.account": "الحساب",
    "settings.security": "الأمان",
    "settings.notifications": "الإشعارات",
    "settings.privacy": "الخصوصية",
    "settings.appearance": "المظهر",
    "settings.support": "الدعم",
    "index.checkingAuth": "جاري التحقق من المصادقة...",
    "posts.loading": "جاري تحميل المنشورات...",
    "posts.none": "لا توجد منشورات بعد.",
    "posts.error": "خطأ",
    "posts.unknown": "غير معروف",
    "posts.image": "صورة",
    "posts.like": "إعجاب",
    "posts.comment": "تعليق",
    "posts.share": "مشاركة",
    "stories.add": "إضافة قصة",
    "stories.loading": "جاري تحميل القصص...",
    "stories.none": "لا توجد قصص بعد.",
    "stories.error": "خطأ في تحميل القصص",
    "home.welcome": "مرحباً بك في دي ميديا",
    "home.feed": "المحتوى الخاص بك",
    "home.trending": "الرائج",
    "home.suggestions": "الاقتراحات",
    "auth.name": "الاسم الكامل",
    "auth.username": "اسم المستخدم",
    "auth.confirmPassword": "تأكيد كلمة المرور",
    "auth.rememberMe": "تذكرني",
    "auth.forgotPassword": "نسيت كلمة المرور؟",
    "auth.verificationSent": "تم إرسال رابط التحقق إلى جيميل الخاص بك! يرجى التحقق من صندوق الوارد والنقر على رابط التحقق لإكمال تسجيل الدخول.",
    "auth.checkGmail": "📧 تحقق من صندوق جيميل الخاص بك للحصول على رابط التحقق",
    "auth.resendVerification": "إعادة إرسال رابط التحقق",
    "auth.usernameRequired": "اسم المستخدم مطلوب",
    "auth.usernameMinLength": "يجب أن يكون اسم المستخدم 3 أحرف على الأقل",
    "auth.nameRequired": "الاسم الكامل مطلوب",
    "auth.emailRequired": "البريد الإلكتروني مطلوب",
    "auth.passwordRequired": "كلمة المرور مطلوبة",
    "auth.passwordMinLength": "يجب أن تكون كلمة المرور 8 أحرف على الأقل",
    "auth.passwordMatch": "يجب أن تتطابق كلمات المرور",
    "auth.usernameTaken": "اسم المستخدم هذا مستخدم بالفعل",
    "auth.emailRegistered": "البريد الإلكتروني هذا مسجل بالفعل",
    "auth.registrationFailed": "فشل التسجيل. يرجى المحاولة باسم مستخدم أو بريد إلكتروني مختلف.",
    "auth.registrationFailedGeneric": "فشل التسجيل. يرجى المحاولة مرة أخرى.",
    "auth.loginFailed": "فشل تسجيل الدخول",
    "auth.invalidCredentials": "بيانات اعتماد غير صحيحة",
    "auth.userCreated": "تم إنشاء المستخدم بنجاح. يمكنك الآن تسجيل الدخول.",
    "auth.creatingAccount": "جاري إنشاء الحساب...",
    "auth.signingIn": "جاري تسجيل الدخول...",
    "auth.login": "تسجيل الدخول",
    "auth.signUp": "إنشاء حساب",
    "auth.signUpTitle": "إنشاء حساب",
    "auth.welcomeBack": "مرحباً بعودتك",
    "auth.welcomeTitle": "انضم إلى DeMedia",
    "auth.alreadyHaveAccount": "هل لديك حساب بالفعل؟",
    "auth.dontHaveAccount": "ليس لديك حساب؟",
    "auth.goToLogin": "الذهاب لتسجيل الدخول",
    "auth.tryAgain": "حاول مرة أخرى",
    "auth.emailInvalid": "يرجى إدخال عنوان بريد إلكتروني صحيح",
    "auth.usernameInvalid": "يمكن أن يحتوي اسم المستخدم على الأحرف الصغيرة والأرقام والشرطات السفلية فقط",
  },
  es: {
    "auth.welcomeBack": "Bienvenido de nuevo",
    "auth.login": "Iniciar sesión",
    "auth.signUp": "Registrarse",
    "auth.email": "Correo electrónico",
    "auth.password": "Contraseña",
    "auth.noAccount": "¿No tienes cuenta?",
    "auth.haveAccount": "¿Ya tienes cuenta?",
    "auth.signingIn": "Iniciando sesión...",
    "auth.creatingAccount": "Creando cuenta...",
    "setup.completeProfile": "Completa tu perfil",
    "setup.preferredLanguage": "Idioma preferido",
    "setup.phoneNumber": "Número de teléfono",
    "setup.saveContinue": "Guardar y continuar",
    "setup.saving": "Guardando...",
    "common.save": "Guardar",
    "common.continue": "Continuar",
    "common.loading": "Cargando",
    "navbar.notifications": "Notificaciones",
    "navbar.messages": "Mensajes",
    "navbar.profile": "Perfil",
    "navbar.logout": "Cerrar sesión",
    "settings.title": "Configuración",
    "settings.language": "Idioma",
    "settings.account": "Cuenta",
    "settings.security": "Seguridad",
    "settings.notifications": "Notificaciones",
    "settings.privacy": "Privacidad",
    "settings.appearance": "Apariencia",
    "settings.support": "Soporte",
    "index.checkingAuth": "Verificando autenticación...",
    "posts.loading": "Cargando publicaciones...",
    "posts.none": "Aún no hay publicaciones.",
    "posts.error": "Error",
    "posts.unknown": "Desconocido",
    "posts.image": "Imagen",
    "posts.like": "Me gusta",
    "posts.comment": "Comentar",
    "posts.share": "Compartir",
    "stories.add": "Agregar historia",
    "stories.loading": "Cargando historias...",
    "stories.none": "Aún no hay historias.",
    "stories.error": "Error al cargar historias",
    "home.welcome": "Bienvenido a DeMedia",
    "home.feed": "Tu feed",
    "home.trending": "Tendencia",
    "home.suggestions": "Sugerencias",
  },
  fr: {
    "auth.welcomeBack": "Bon retour",
    "auth.login": "Connexion",
    "auth.signUp": "S'inscrire",
    "auth.email": "Adresse e-mail",
    "auth.password": "Mot de passe",
    "auth.noAccount": "Vous n'avez pas de compte ?",
    "auth.haveAccount": "Vous avez déjà un compte ?",
    "auth.signingIn": "Connexion en cours...",
    "auth.creatingAccount": "Création du compte...",
    "setup.completeProfile": "Complétez votre profil",
    "setup.preferredLanguage": "Langue préférée",
    "setup.phoneNumber": "Numéro de téléphone",
    "setup.saveContinue": "Enregistrer et continuer",
    "setup.saving": "Enregistrement...",
    "common.save": "Enregistrer",
    "common.continue": "Continuer",
    "common.loading": "Chargement",
    "navbar.notifications": "Notifications",
    "navbar.messages": "Messages",
    "navbar.profile": "Profil",
    "navbar.logout": "Déconnexion",
    "settings.title": "Paramètres",
    "settings.language": "Langue",
    "settings.account": "Compte",
    "settings.security": "Sécurité",
    "settings.notifications": "Notifications",
    "settings.privacy": "Confidentialité",
    "settings.appearance": "Apparence",
    "settings.support": "Support",
    "index.checkingAuth": "Vérification de l'authentification...",
    "posts.loading": "Chargement des publications...",
    "posts.none": "Aucune publication pour le moment.",
    "posts.error": "Erreur",
    "posts.unknown": "Inconnu",
    "posts.image": "Image",
    "posts.like": "J'aime",
    "posts.comment": "Commenter",
    "posts.share": "Partager",
    "stories.add": "Ajouter une histoire",
    "stories.loading": "Chargement des histoires...",
    "stories.none": "Aucune histoire pour le moment.",
    "stories.error": "Erreur lors du chargement des histoires",
    "home.welcome": "Bienvenue sur DeMedia",
    "home.feed": "Votre fil",
    "home.trending": "Tendances",
    "home.suggestions": "Suggestions",
  },
  de: {
    "auth.welcomeBack": "Willkommen zurück",
    "auth.login": "Anmelden",
    "auth.signUp": "Registrieren",
    "auth.email": "E-Mail-Adresse",
    "auth.password": "Passwort",
    "auth.noAccount": "Haben Sie kein Konto?",
    "auth.haveAccount": "Haben Sie bereits ein Konto?",
    "auth.signingIn": "Anmeldung läuft...",
    "auth.creatingAccount": "Konto wird erstellt...",
    "setup.completeProfile": "Vervollständigen Sie Ihr Profil",
    "setup.preferredLanguage": "Bevorzugte Sprache",
    "setup.phoneNumber": "Telefonnummer",
    "setup.saveContinue": "Speichern und fortfahren",
    "setup.saving": "Speichern...",
    "common.save": "Speichern",
    "common.continue": "Fortfahren",
    "common.loading": "Laden",
    "navbar.notifications": "Benachrichtigungen",
    "navbar.messages": "Nachrichten",
    "navbar.profile": "Profil",
    "navbar.logout": "Abmelden",
    "settings.title": "Einstellungen",
    "settings.language": "Sprache",
    "settings.account": "Konto",
    "settings.security": "Sicherheit",
    "settings.notifications": "Benachrichtigungen",
    "settings.privacy": "Datenschutz",
    "settings.appearance": "Erscheinungsbild",
    "settings.support": "Support",
    "index.checkingAuth": "Authentifizierung wird überprüft...",
    "posts.loading": "Beiträge werden geladen...",
    "posts.none": "Noch keine Beiträge.",
    "posts.error": "Fehler",
    "posts.unknown": "Unbekannt",
    "posts.image": "Bild",
    "posts.like": "Gefällt mir",
    "posts.comment": "Kommentieren",
    "posts.share": "Teilen",
    "stories.add": "Geschichte hinzufügen",
    "stories.loading": "Geschichten werden geladen...",
    "stories.none": "Noch keine Geschichten.",
    "stories.error": "Fehler beim Laden der Geschichten",
    "home.welcome": "Willkommen bei DeMedia",
    "home.feed": "Ihr Feed",
    "home.trending": "Trending",
    "home.suggestions": "Vorschläge",
  },
};

export const I18nProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [language, setLanguageState] = useState<Locale>("en");
  const [translations, setTranslations] = useState<Record<Locale, Translations>>(BASE_TRANSLATIONS);

  useEffect(() => {
    const stored = typeof window !== "undefined" ? localStorage.getItem("language") : null;
    if (stored && SUPPORTED.find(l => l.code === stored)) {
      setLanguageState(stored);
    }
  }, []);

  const setLanguage = (lng: Locale) => {
    setLanguageState(lng);
    if (typeof window !== "undefined") localStorage.setItem("language", lng);
  };

  const t = (key: string, fallback?: string): string => {
    const lang = translations[language] || {};
    if (lang[key]) return lang[key];
    const en = translations["en"] || {};
    return en[key] || fallback || key;
  };

  const value = useMemo<I18nContextType>(() => ({
    language,
    setLanguage,
    t,
    supportedLocales: SUPPORTED,
  }), [language, translations]);

  return (
    <I18nContext.Provider value={value}>{children}</I18nContext.Provider>
  );
};


